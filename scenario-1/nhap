
PS C:\Users\vulin\Desktop\app\stress-test\scenario-1> node test-single.js
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  1. LOGIN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Token: âœ… Got token

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  2. TEST GROUP A: RECOMMEND MODEL (A23 - SUPER AMBIGUOUS)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸ“¤ REQUEST:
   Endpoint: POST /llm-orchestrator/recommend-model
   Body: { business_description: "Kho hÃ ng cá»§a tÃ´i nháº­p xuáº¥t liÃªn tá»¥c, bÃ¡n cho khÃ¡ch vÃ£ng lai lÃ  chÃ­nh. KhÃ´ng cáº§n lÆ°u thÃ´ng tin khÃ¡ch hÃ ng." }

ðŸ“¥ LLM RESPONSE:
{
  "next_steps": [
    "Chá»n mÃ´ hÃ¬nh 'BÃ¡n hÃ ng truyá»n thá»‘ng' Ä‘á»ƒ báº¯t Ä‘áº§u.",
    "ÄÄƒng táº£i cÃ¡c sáº£n pháº©m trong kho cá»§a báº¡n lÃªn.",
    "Báº¯t Ä‘áº§u nháº­n Ä‘Æ¡n hÃ ng vÃ  giao cho khÃ¡ch vÃ£ng lai!"
  ],
  "alternatives": [
    {
      "model": "multi",
      "brief_reason": "Náº¿u báº¡n muá»‘n thÃªm cÃ¡c dá»‹ch vá»¥ giÃ¡ trá»‹ gia tÄƒng hoáº·c chÆ°Æ¡ng trÃ¬nh khÃ¡ch hÃ ng thÃ¢n thiáº¿t sau nÃ y Ä‘á»ƒ giá»¯ chÃ¢n khÃ¡ch."
    },
    {
      "model": "subscription",
      "brief_reason": "Náº¿u báº¡n cÃ³ thá»ƒ Ä‘Ã³ng gÃ³i cÃ¡c sáº£n pháº©m tá»« kho thÃ nh 'há»™p quÃ  báº¥t ngá»' hoáº·c gÃ³i hÃ ng thiáº¿t yáº¿u gá»­i Ä‘á»‹nh ká»³ cho khÃ¡ch."
    }
  ],
  "greeting": "ChÃ o báº¡n! ðŸ‘‹ MÃ¬nh hiá»ƒu báº¡n Ä‘ang muá»‘n tÃ¬m cÃ¡ch kinh doanh phÃ¹ há»£p cho kho hÃ ng nháº­p xuáº¥t liÃªn tá»¥c cá»§a mÃ¬nh.",
  "recommendation_intro": "Dá»±a vÃ o mÃ´ táº£ cá»§a báº¡n vá» viá»‡c bÃ¡n hÃ ng cho khÃ¡ch vÃ£ng lai vÃ  khÃ´ng cáº§n lÆ°u thÃ´ng tin, mÃ¬nh nghÄ© cÃ¡ch váº­n hÃ nh phÃ¹ há»£p nháº¥t chÃ­nh lÃ :",
  "recommended_model": "retail",
  "why_this_fits": "1. Sáº£n pháº©m cá»§a báº¡n lÃ  hÃ ng hÃ³a váº­t lÃ½ (tá»« kho hÃ ng), Ä‘Æ°á»£c bÃ¡n trá»±c tiáº¿p vÃ  dá»©t Ä‘iá»ƒm cho khÃ¡ch hÃ ng. \n2. KhÃ¡ch vÃ£ng lai thÆ°á»ng chá»‰ mua má»™t láº§n vÃ  thanh toÃ¡n xong lÃ  nháº­n hÃ ng, khÃ´ng cáº§n cÃ¡c gÃ³i dá»‹ch vá»¥ hay cam káº¿t Ä‘á»‹nh ká»³. \n3. MÃ´ hÃ¬nh nÃ y ráº¥t Ä‘Æ¡n giáº£n Ä‘á»ƒ quáº£n lÃ½ giao dá»‹ch mua bÃ¡n, giÃºp báº¡n táº­p trung vÃ o viá»‡c nháº­p xuáº¥t vÃ  bÃ¡n hÃ ng mÃ  khÃ´ng cáº§n phá»©c táº¡p hÃ³a viá»‡c lÆ°u trá»¯ thÃ´ng tin khÃ¡ch hÃ ng.",
  "how_it_works": "Ráº¥t Ä‘Æ¡n giáº£n, mÃ´ hÃ¬nh nÃ y hoáº¡t Ä‘á»™ng y nhÆ° má»™t cá»­a hÃ ng bÃ¡n láº» truyá»n thá»‘ng hoáº·c má»™t gian hÃ ng trÃªn Shopee, Tiki váº­y Ä‘Ã³: KhÃ¡ch hÃ ng tháº¥y sáº£n pháº©m báº¡n cÃ³ -> Há» chá»n mua vÃ  thanh toÃ¡n má»™t láº§n -> Báº¡n giao hÃ ng cho há» -> Giao dá»‹ch hoÃ n táº¥t. Xong!",
  "alternatives_intro": "Tuy nhiÃªn, náº¿u sau nÃ y báº¡n muá»‘n má»Ÿ rá»™ng hoáº·c cÃ³ Ã½ tÆ°á»Ÿng khÃ¡c, báº¡n cÃ³ thá»ƒ cÃ¢n nháº¯c:",
  "closing": "Báº¯t Ä‘áº§u vá»›i 'BÃ¡n hÃ ng truyá»n thá»‘ng' lÃ  cÃ¡ch Ä‘Æ¡n giáº£n vÃ  hiá»‡u quáº£ nháº¥t cho mÃ´ hÃ¬nh kho hÃ ng hiá»‡n táº¡i cá»§a báº¡n. ChÃºc báº¡n buÃ´n may bÃ¡n Ä‘áº¯t nhÃ©! ðŸš€"
}

ðŸ” VALIDATION LOGIC:
   - Expected model: retail (vÃ¬ bÃ¡n cho khÃ¡ch vÃ£ng lai, khÃ´ng lÆ°u info)
   - recommended_model = retail
   - ÄÃºng lÃ  retail? YES âœ…
   â†’ Káº¾T QUáº¢: âœ… PASS - LLM hiá»ƒu Ä‘Ãºng ngá»¯ cáº£nh!

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  3. TEST GROUP B: TEXT TO SQL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸ“¤ REQUEST:
   Endpoint: POST /llm-orchestrator/text-to-sql
   Body: { question: "Doanh thu thÃ¡ng 12 nÄƒm 2025 lÃ  bao nhiÃªu?" }

ðŸ“¥ LLM RESPONSE:
{
  "success": true,
  "question": "Doanh thu thÃ¡ng 12 nÄƒm 2025 lÃ  bao nhiÃªu?",
  "sql": "SELECT SUM(`totalAmount`) AS `Doanh_thu_thang_12_2025` FROM `orders` AS `o` WHERE `paymentStatus` = 'paid' AND YEAR(`updatedAt`) = 2025 AND MONTH(`updatedAt`) = 12 LIMIT 1",
  "natural_response": "ChÃ o báº¡n, doanh thu cá»§a thÃ¡ng 12 nÄƒm 2025 lÃ  **4.999,96 Ä‘** ðŸ’°. ÄÃ¢y lÃ  tá»•ng doanh thu tá»« cÃ¡c Ä‘Æ¡n hÃ ng Ä‘Ã£ Ä‘Æ°á»£c thanh toÃ¡n thÃ nh cÃ´ng trong thÃ¡ng Ä‘Ã³. Hy vá»ng thÃ´ng tin nÃ y há»¯u Ã­ch cho báº¡n! âœ…",
  "raw_data": "[{\"Doanh_thu_thang_12_2025\":\"4999.96\"}]",
  "error": ""
}

ðŸ” VALIDATION LOGIC:
   - Kiá»ƒm tra: SQL Ä‘Æ°á»£c generate khÃ´ng?
   - sql = SELECT SUM(`totalAmount`) AS `Doanh_thu_thang_12_2025` FROM `orders` AS `o` WHERE `paymentStatus` = 'paid' AND YEAR(`updatedAt`) = 2025 AND MONTH(`updatedAt`) = 12 LIMIT 1
   - natural_response = ChÃ o báº¡n, doanh thu cá»§a thÃ¡ng 12 nÄƒm 2025 lÃ  **4.999,96 Ä‘** ðŸ’°. ÄÃ¢y lÃ  tá»•ng doanh thu tá»« cÃ¡c Ä‘Æ¡n hÃ n...
   - raw_data = [{"Doanh_thu_thang_12_2025":"4999.96"}]
   - CÃ³ SQL query? YES
   â†’ Káº¾T QUáº¢: âœ… PASS

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  4. TEST GROUP C: RCA (Root Cause Analysis)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸ“¤ REQUEST:
   Endpoint: POST /llm-orchestrator/analyze-incident
   Body: { incident_description: "[PaymentService] Error: StripeError: card_declined" }

ðŸ“¥ LLM RESPONSE:
{
  "recommendations": [],
  "severity": "unknown",
  "analysis": "[GoogleGenerativeAI Error]: Error fetching from https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent: [429 Too Many Requests] You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 20, model: gemini-2.5-flash\nPlease retry in 25.394554723s. [{\"@type\":\"type.googleapis.com/google.rpc.Help\",\"links\":[{\"description\":\"Learn more about Gemini API quotas\",\"url\":\"https://ai.google.dev/gemini-api/docs/rate-limits\"}]},{\"@type\":\"type.googleapis.com/google.rpc.QuotaFailure\",\"violations\":[{\"quotaMetric\":\"generativelanguage.googleapis.com/generate_content_free_tier_requests\",\"quotaId\":\"GenerateRequestsPerDayPerProjectPerModel-FreeTier\",\"quotaDimensions\":{\"location\":\"global\",\"model\":\"gemini-2.5-flash\"},\"quotaValue\":\"20\"}]},{\"@type\":\"type.googleapis.com/google.rpc.RetryInfo\",\"retryDelay\":\"25s\"}]",
  "raw_response": "[GoogleGenerativeAI Error]: Error fetching from https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent: [429 Too Many Requests] You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 20, model: gemini-2.5-flash\nPlease retry in 25.394554723s. [{\"@type\":\"type.googleapis.com/google.rpc.Help\",\"links\":[{\"description\":\"Learn more about Gemini API quotas\",\"url\":\"https://ai.google.dev/gemini-api/docs/rate-limits\"}]},{\"@type\":\"type.googleapis.com/google.rpc.QuotaFailure\",\"violations\":[{\"quotaMetric\":\"generativelanguage.googleapis.com/generate_content_free_tier_requests\",\"quotaId\":\"GenerateRequestsPerDayPerProjectPerModel-FreeTier\",\"quotaDimensions\":{\"location\":\"global\",\"model\":\"gemini-2.5-flash\"},\"quotaValue\":\"20\"}]},{\"@type\":\"type.googleapis.com/google.rpc.RetryInfo\",\"retryDelay\":\"25s\"}]"
}

ðŸ” VALIDATION LOGIC:
   - Kiá»ƒm tra: CÃ³ analysis vá»›i root_cause khÃ´ng?
   - severity = unknown
   - root_cause = N/A
   - confidence = undefined
   - CÃ³ analysis há»£p lá»‡? YES
   â†’ Káº¾T QUáº¢: âœ… PASS

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  SUMMARY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  Group A (Recommend Model): âœ… PASS
  Group B (Text-to-SQL): âœ… PASS
  Group C (RCA): âœ… PASS
PS C:\Users\vulin\Desktop\app\stress-test\scenario-1> 